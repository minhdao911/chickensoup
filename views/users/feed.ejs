<% include ../partials/header%>

    <% include ../partials/user-menu%>

            <div class="ui secondary vertical pointing menu">
              <a href="/users/<%= user._id%>" class="item">
                Home
              </a>
              <a href="/users/<%= user._id%>/blogs" class="item">
                Blogs
              </a>
              <% if(currentUser && user.username === currentUser.username) {%>
                <a href="/users/<%= user._id%>/feeds" class="item third-element active">
                  New Feed<span class="ui blue circular label"><%= currentUser.feeds.length%></span>
                </a>
                <!--<a href="/users/<%= user._id%>/messages" class="item">-->
                <!--  Messages<span class="ui blue circular label">1</span>-->
                <!--</a>-->
              <% } %>
              <a href="/users/<%= user._id%>/following" class="item">
                Following
              </a>
            </div>
            <!--<% if(currentUser && user.username !== currentUser.username) {%>-->
            <!--  <a id="leave-mess-btn" class="ui button">Leave a message<i class="talk outline icon" style="margin-left: 3px;"></i></a>-->
            <!--<% } %>-->
        </div>
        
        <% if(currentUser && user.username === currentUser.username) {%>
          <div class="ui fluid four item menu">
            <a href="/users/<%= user._id%>" class="item">Home</a>
            <a href="/users/<%= user._id%>/blogs" class="item">Blogs</a>
            <a href="/users/<%= user._id%>/feeds" class="item third-element" style="color: #56aaff;">
              New Feed<i class="ui blue circular label"><%= currentUser.feeds.length%></i>
            </a>
            <a href="/users/<%= user._id%>/following" class="item">Following</a>
          </div>
        <% }else{ %>
          <div class="ui fluid three item menu">
            <a href="/users/<%= user._id%>" class="item">Home</a>
            <a href="/users/<%= user._id%>/blogs" class="item">Blogs</a>
            <a href="/users/<%= user._id%>/following" class="item">Following</a>
          </div>
        <% } %>
        
        <div id="feed" class="ui segment user-info">
            <div class="ui feed">
            <% var feeds = user.feeds%>
              <% if(feeds.length > 0){ %>
                <% for(var i=feeds.length-1; i>-1; i--){ %>
                <% if(feeds[i].content==="started following you"){%>
                    <div class="event">
                        <div class="label">
                            <img src="<%= feeds[i].avatar%>">
                        </div>
                          <div class="content" onclick="location.href='/users/<%= feeds[i].user_id%>'">
                              <div class="summary">
                                  <a href="/users/<%= feeds[i].user_id%>" class="user">
                                      <%= feeds[i].username%>
                                  </a> <%= feeds[i].content%>
                              </div>
                              <div class="meta">
                                <% var currentTime = new Date() %>
                                <% if(feeds[i].created.getMonth() === currentTime.getMonth()){ %>
                                  <% if(feeds[i].created.getDate() === currentTime.getDate()){ %>
                                    <% if(feeds[i].created.getHours()+3 >= 24){%>
                                      <p>Today at <%= feeds[i].created.getHours()-24%>:<%= feeds[i].created.getMinutes()%></p>
                                    <% }else{ %>
                                      <p>Today at <%= feeds[i].created.getHours()+3%>:<%= feeds[i].created.getMinutes()%></p>
                                    <% } %>
                                  <% }else if(currentTime.getDate() - feeds[i].created.getDate() === 1){ %>
                                    <p>Yesterday at <%= feeds[i].created.getHours()+3%>:<%= feeds[i].created.getMinutes()%></p>
                                  <% }else if(currentTime.getDate() - feeds[i].created.getDate() < 8){ %>
                                    <p><%= currentTime.getDate() - feeds[i].created.getDate()%> days ago
                                  <% } %>
                                <% }else{ %>
                                  <p><%= feeds[i].created.getDate()%>/<%= feeds[i].created.getMonth()+1%>/<%= feeds[i].created.getFullYear()%></p>
                                <% } %>
                              </div>
                          </div>
                        <form action="/users/<%= user._id%>/<%= feeds[i]._id%>/delfeed?_method=PUT" method="POST">
                          <button><i class="close icon"></i></button>
                        </form>
                    </div>
                  <% }else{ %>
                    <div class="event">
                        <div class="label">
                            <img src="<%= feeds[i].avatar%>">
                        </div>
                          <div class="content" onclick="location.href='/blogs/<%= feeds[i].blog_id%>'">
                              <div class="summary">
                                  <a href="/users/<%= feeds[i].user_id%>" class="user">
                                      <%= feeds[i].username%>
                                  </a> <%= feeds[i].content%>
                              </div>
                              <div class="meta">
                                <% var currentTime = new Date() %>
                                <% if(feeds[i].created.getMonth() === currentTime.getMonth()){ %>
                                  <% if(feeds[i].created.getDate() === currentTime.getDate()){ %>
                                    <% if(feeds[i].created.getHours()+3 >= 24){%>
                                      <p>Today at <%= feeds[i].created.getHours()+3-24%>:<%= feeds[i].created.getMinutes()%></p>
                                    <% }else{ %>
                                      <p>Today at <%= feeds[i].created.getHours()+3%>:<%= feeds[i].created.getMinutes()%></p>
                                    <% } %>
                                  <% }else if(currentTime.getDate() - feeds[i].created.getDate() === 1){ %>
                                    <p>Yesterday at <%= feeds[i].created.getHours()+3%>:<%= feeds[i].created.getMinutes()%></p>
                                  <% }else if(currentTime.getDate() - feeds[i].created.getDate() < 8){ %>
                                    <p><%= currentTime.getDate() - feeds[i].created.getDate()%> days ago
                                  <% } %>
                                <% }else{ %>
                                  <p><%= feeds[i].created.getDate()%>/<%= feeds[i].created.getMonth()+1%>/<%= feeds[i].created.getFullYear()%></p>
                                <% } %>
                              </div>
                          </div>
                        <form action="/users/<%= user._id%>/<%= feeds[i]._id%>/delfeed?_method=PUT" method="POST">
                          <button><i class="close icon"></i></button>
                        </form>
                    </div>
                  <% } %>
                <% } %>
              <% }else{ %>
                <p>No feed</p>
              <% } %>
            </div>    
        </div>
    </div>
</div>

<script type="text/javascript" src="/scripts/maintainscroll.jquery.min.js"></script>
<% include ../partials/footer%>